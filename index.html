<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>لوحة التحكم الديناميكية - إدارة شاملة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f8fafc; }
        .sidebar-item { @apply flex items-center justify-between w-full p-4 rounded-2xl font-bold transition-all duration-200 mb-2; }
        .tab-active { @apply bg-blue-600 text-white shadow-lg; }
        .tab-inactive { @apply text-slate-500 hover:bg-white hover:shadow-sm hover:text-blue-600; }
        input { @apply w-full p-3 rounded-xl border-2 border-slate-200 outline-none focus:border-blue-500 transition-all; }
        .card { @apply bg-white p-6 rounded-3xl shadow-sm border border-slate-100; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
          apiKey: "AIzaSyBdlRDPTQqY8lZvD4R7nneXAwPgRbxmm14",
          authDomain: "councour-59e43.firebaseapp.com",
          projectId: "councour-59e43",
          storageBucket: "councour-59e43.firebasestorage.app",
          messagingSenderId: "492907661374",
          appId: "1:492907661374:web:31792fc3ab95d0e69ea96f",
          measurementId: "G-2NLB5H3NQH"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const App = () => {
            const [view, setView] = useState('user'); 
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [tabs, setTabs] = useState([]);

            useEffect(() => {
                const unsubAuth = auth.onAuthStateChanged(user => setIsLoggedIn(!!user));
                const unsubTabs = db.collection("settings").doc("navigation").onSnapshot(doc => {
                    if (doc.exists) setTabs(doc.data().list);
                    else {
                        // إنشاء التبويبات الافتراضية إذا كانت غير موجودة
                        const initial = [
                            { id: 'data', label: 'المترشحين', icon: 'fa-users' },
                            { id: 'manage', label: 'إدارة التبويبات', icon: 'fa-gear' }
                        ];
                        db.collection("settings").doc("navigation").set({ list: initial });
                    }
                });
                return () => { unsubAuth(); unsubTabs(); };
            }, []);

            return (
                <div className="min-h-screen">
                    <header className="h-16 bg-white border-b flex justify-between items-center px-6 sticky top-0 z-50">
                        <div className="flex items-center gap-2 font-black text-blue-600">
                            <i className="fa-solid fa-server text-xl"></i>
                            <span>نظام الإدارة</span>
                        </div>
                        <button onClick={() => setView(view === 'user' ? 'admin' : 'user')} className="text-sm font-bold bg-slate-100 px-4 py-2 rounded-lg">
                            {view === 'user' ? 'فتح لوحة التحكم' : 'خروج للموقع'}
                        </button>
                    </header>

                    {view === 'user' ? (
                        <div className="p-20 text-center text-slate-400 font-bold">واجهة المترشحين</div>
                    ) : (
                        isLoggedIn ? <AdminArea tabs={tabs} /> : <AdminLogin />
                    )}
                </div>
            );
        };

        const AdminArea = ({ tabs }) => {
            const [activeTab, setActiveTab] = useState(tabs[0]?.id || 'data');

            return (
                <div className="flex flex-col md:flex-row min-h-[calc(100vh-64px)]">
                    <aside className="w-full md:w-72 bg-slate-50 border-l p-6">
                        <p className="text-[10px] font-black text-slate-400 mb-4 uppercase">القائمة</p>
                        {tabs.map(tab => (
                            <button 
                                key={tab.id} 
                                onClick={() => setActiveTab(tab.id)}
                                className={`sidebar-item ${activeTab === tab.id ? 'tab-active' : 'tab-inactive'}`}
                            >
                                <div className="flex items-center gap-3">
                                    <i className={`fa-solid ${tab.icon}`}></i>
                                    {tab.label}
                                </div>
                            </button>
                        ))}
                    </aside>

                    <main className="flex-1 p-8">
                        {activeTab === 'manage' ? <TabsEditor tabs={tabs} /> : (
                            <div className="card">
                                <h2 className="text-2xl font-black mb-4">محتوى التبويب: {tabs.find(t => t.id === activeTab)?.label}</h2>
                                <p className="text-slate-500">هذه المساحة مخصصة لعرض بيانات {tabs.find(t => t.id === activeTab)?.label}.</p>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const TabsEditor = ({ tabs }) => {
            const [editingTab, setEditingTab] = useState(null);
            const [newTab, setNewTab] = useState({ label: '', icon: 'fa-star' });

            const save = (newList) => db.collection("settings").doc("navigation").update({ list: newList });

            const handleAdd = () => {
                if (!newTab.label) return;
                const id = 't_' + Date.now();
                save([...tabs, { ...newTab, id }]);
                setNewTab({ label: '', icon: 'fa-star' });
            };

            const handleDelete = (id) => {
                if (confirm("هل أنت متأكد من حذف هذا التبويب نهائياً؟")) {
                    save(tabs.filter(t => t.id !== id));
                }
            };

            const handleUpdate = () => {
                const newList = tabs.map(t => t.id === editingTab.id ? editingTab : t);
                save(newList);
                setEditingTab(null);
            };

            return (
                <div className="max-w-4xl space-y-6">
                    {/* إضافة تبويب جديد */}
                    <div className="card border-r-4 border-blue-600">
                        <h3 className="font-black mb-4 text-slate-800">إضافة تبويب جديد</h3>
                        <div className="flex flex-col md:flex-row gap-3">
                            <input placeholder="اسم التبويب (مثلاً: الإحصائيات)" value={newTab.label} onChange={e => setNewTab({...newTab, label: e.target.value})} />
                            <input placeholder="أيقونة (fa-user)" value={newTab.icon} onChange={e => setNewTab({...newTab, icon: e.target.value})} />
                            <button onClick={handleAdd} className="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold">إضافة</button>
                        </div>
                    </div>

                    {/* قائمة التبويبات مع خيارات التعديل والحذف */}
                    <div className="card">
                        <h3 className="font-black mb-6 text-slate-800 text-lg underline">التحكم في التبويبات الحالية</h3>
                        <div className="space-y-3">
                            {tabs.map(tab => (
                                <div key={tab.id} className="bg-slate-50 p-4 rounded-2xl flex flex-col md:flex-row justify-between gap-4 border border-slate-100">
                                    {editingTab?.id === tab.id ? (
                                        <div className="flex flex-1 flex-col md:flex-row gap-2">
                                            <input value={editingTab.label} onChange={e => setEditingTab({...editingTab, label: e.target.value})} />
                                            <input value={editingTab.icon} onChange={e => setEditingTab({...editingTab, icon: e.target.value})} />
                                            <button onClick={handleUpdate} className="bg-green-600 text-white px-4 rounded-xl font-bold">حفظ</button>
                                            <button onClick={() => setEditingTab(null)} className="bg-slate-300 px-4 rounded-xl font-bold">إلغاء</button>
                                        </div>
                                    ) : (
                                        <>
                                            <div className="flex items-center gap-4">
                                                <div className="w-12 h-12 bg-white rounded-xl flex items-center justify-center text-blue-600 shadow-sm border border-slate-100">
                                                    <i className={`fa-solid ${tab.icon} text-lg`}></i>
                                                </div>
                                                <div>
                                                    <p className="font-black text-slate-800">{tab.label}</p>
                                                    <p className="text-[10px] text-slate-400 font-mono italic">{tab.icon}</p>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <button onClick={() => setEditingTab(tab)} className="w-10 h-10 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white transition-all">
                                                    <i className="fa-solid fa-pen-to-square"></i>
                                                </button>
                                                <button onClick={() => handleDelete(tab.id)} className="w-10 h-10 rounded-lg bg-red-50 text-red-500 hover:bg-red-500 hover:text-white transition-all">
                                                    <i className="fa-solid fa-trash-can"></i>
                                                </button>
                                            </div>
                                        </>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const AdminLogin = () => {
            const [email, setEmail] = useState('');
            const [pass, setPass] = useState('');
            const login = async (e) => {
                e.preventDefault();
                try { await auth.signInWithEmailAndPassword(email, pass); } catch(err) { alert("بيانات خاطئة!"); }
            };
            return (
                <div className="max-w-md mx-auto mt-20 card border-t-8 border-slate-900">
                    <h2 className="text-2xl font-black text-center mb-8">تسجيل الدخول</h2>
                    <form onSubmit={login} className="space-y-4">
                        <input type="email" placeholder="البريد الإلكتروني" onChange={e => setEmail(e.target.value)} />
                        <input type="password" placeholder="كلمة المرور" onChange={e => setPass(e.target.value)} />
                        <button className="w-full bg-slate-900 text-white py-4 rounded-2xl font-black">دخول آمن</button>
                    </form>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
