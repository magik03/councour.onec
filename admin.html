
<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>لوحة تحكم المسؤول - Firebase</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
      // 1. إعداد Firebase ببياناتك الخاصة
      const firebaseConfig = {
        apiKey: "AIzaSyBdlRDPTQqY8lZvD4R7nneXAwPgRbxmm14",
        authDomain: "councour-59e43.firebaseapp.com",
        projectId: "councour-59e43",
        storageBucket: "councour-59e43.firebasestorage.app",
        messagingSenderId: "492907661374",
        appId: "1:492907661374:web:31792fc3ab95d0e69ea96f"
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Tajawal', 'sans-serif'] },
            colors: { 'dz-green': '#008568', 'admin-blue': '#0f172a' }
          },
        },
      }
    </script>
    <style>
      /* الستايلات الخاصة بك بقيت كما هي لضمان جمالية التصميم */
      .modal-overlay { background: rgba(2, 6, 23, 0.9); backdrop-filter: blur(12px); }
      .detail-card { background: #ffffff; border-radius: 1rem; padding: 1rem; border: 1px solid #e2e8f0; }
      .detail-label { font-size: 0.75rem; font-weight: 800; color: #64748b; display: block; border-bottom: 1px dashed #e2e8f0; margin-bottom: 0.25rem; }
      .detail-value { font-size: 1rem; font-weight: 900; color: #0f172a; word-break: break-all; }
      .section-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem; border-bottom: 3px solid #0f172a; padding-bottom: 0.5rem; }
      .year-row { background: #f1f5f9; border-right: 4px solid #008568; padding: 0.75rem; border-radius: 0.75rem; display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
    </style>
  </head>
  <body class="bg-slate-50 font-sans text-right text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // مكونات الأيقونات كما هي في كودك الأصلي
      const Icon = ({ children, size = 20, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
      );
      const Eye = (p) => <Icon {...p}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" /><circle cx="12" cy="12" r="3" /></Icon>;
      const Trash = (p) => <Icon {...p}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /></Icon>;
      const Briefcase = (p) => <Icon {...p}><rect width="20" height="14" x="2" y="7" rx="2" ry="2" /><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2-2v16" /></Icon>;
      const User = (p) => <Icon {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></Icon>;
      const GraduationCap = (p) => <Icon {...p}><path d="M22 10v6M2 10l10-5 10 5-10 5z" /><path d="M6 12v5c3 3 9 3 12 0v-5" /></Icon>;
      const BookOpen = (p) => <Icon {...p}><path d="M2 3h6a4 4 0 0 1 4 4v14a4 4 0 0 0-4-4H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a4 4 0 0 1 4-4h6z"/></Icon>;
      const Home = (p) => <Icon {...p}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
      const Mail = (p) => <Icon {...p}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" /><polyline points="22,6 12,13 2,6" /></Icon>;

      const DetailBlock = ({ label, value }) => (
        <div className="detail-card">
          <span className="detail-label">{label}</span>
          <span className="detail-value">{value || '---'}</span>
        </div>
      );

      const App = () => {
        const [submissions, setSubmissions] = useState([]);
        const [selected, setSelected] = useState(null);
        const [loading, setLoading] = useState(true);

        // 2. جلب البيانات من Firebase Realtime Database
        useEffect(() => {
          const submissionsRef = db.ref('submissions');
          submissionsRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
              const formattedList = Object.keys(data).map(key => ({
                id: key,
                ...data[key]
              }));
              setSubmissions(formattedList);
            } else {
              setSubmissions([]);
            }
            setLoading(false);
          });
          return () => submissionsRef.off();
        }, []);

        // 3. تحديث الحالة في Firebase
        const updateStatus = (id, newStatus) => {
          db.ref(`submissions/${id}`).update({ status: newStatus })
            .then(() => {
              if (selected) setSelected({...selected, status: newStatus});
            })
            .catch(err => alert("خطأ في التحديث: " + err.message));
        };

        // 4. حذف السجل من Firebase
        const deleteEntry = (id) => {
          if (confirm('هل أنت متأكد من الحذف النهائي؟')) {
            db.ref(`submissions/${id}`).remove()
              .catch(err => alert("خطأ في الحذف: " + err.message));
          }
        };

        return (
          <div className="min-h-screen flex flex-col">
            <header className="bg-admin-blue text-white p-6 shadow-2xl sticky top-0 z-50">
              <div className="max-w-7xl mx-auto flex justify-between items-center">
                <div className="flex items-center gap-4">
                  <div className="bg-dz-green p-2 rounded-lg"><Briefcase size={24}/></div>
                  <h1 className="text-2xl font-black">لوحة تحكم المسؤول (قاعدة بيانات حية)</h1>
                </div>
                <div className="bg-dz-green px-6 py-2 rounded-full font-black">
                  إجمالي المسجلين: {submissions.length}
                </div>
              </div>
            </header>

            <main className="max-w-7xl mx-auto w-full p-6 md:p-12">
              {loading ? (
                <div className="text-center py-20 font-bold text-slate-500">جاري تحميل البيانات من السحابة...</div>
              ) : (
                <div className="bg-white rounded-[2rem] shadow-xl border overflow-hidden">
                  <table className="w-full text-right">
                    <thead>
                      <tr className="bg-slate-100 border-b-2">
                        <th className="px-8 py-5 font-black">التاريخ</th>
                        <th className="px-8 py-5 font-black">المترشح</th>
                        <th className="px-8 py-5 font-black">الرتبة</th>
                        <th className="px-8 py-5 font-black text-center">الحالة</th>
                        <th className="px-8 py-5 font-black text-center">إجراءات</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y">
                      {submissions.length === 0 ? (
                        <tr><td colSpan="5" className="px-8 py-20 text-center text-slate-400">لا توجد بيانات حالياً</td></tr>
                      ) : submissions.map(s => (
                        <tr key={s.id} className="hover:bg-slate-50">
                          <td className="px-8 py-6 text-xs text-slate-500">{s.submissionDate}</td>
                          <td className="px-8 py-6 font-black">{s.lastNameAr} {s.firstNameAr}</td>
                          <td className="px-8 py-6 text-sm">{s.rank}</td>
                          <td className="px-8 py-6 text-center">
                            <span className={`px-4 py-1.5 rounded-full text-xs font-black border ${
                              s.status === 'مقبول' ? 'bg-green-50 text-green-700 border-green-200' : 
                              s.status === 'مرفوض' ? 'bg-red-50 text-red-700 border-red-200' : 'bg-amber-50 text-amber-800 border-amber-200'
                            }`}>{s.status || 'قيد الانتظار'}</span>
                          </td>
                          <td className="px-8 py-6 flex justify-center gap-2">
                            <button onClick={() => setSelected(s)} className="p-2.5 bg-admin-blue text-white rounded-lg"><Eye/></button>
                            <button onClick={() => deleteEntry(s.id)} className="p-2.5 bg-red-50 text-red-600 rounded-lg border border-red-100"><Trash/></button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </main>

            {/* نافذة المعاينة (باقي الكود كما هو مع إضافة زر التحديث) */}
            {selected && (
              <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 modal-overlay">
                <div className="bg-white rounded-[3rem] w-full max-w-6xl max-h-[90vh] overflow-y-auto p-8 relative">
                   {/* محتوى المعاينة المذكور في كودك الأصلي... */}
                   <div className="flex justify-between items-center mb-8 border-b pb-4">
                      <h3 className="text-2xl font-black">ملف المترشح: {selected.lastNameAr}</h3>
                      <button onClick={() => setSelected(null)} className="text-3xl">&times;</button>
                   </div>
                   
                   {/* مثال لعرض بيانات الهوية */}
                   <section className="mb-8">
                      <div className="section-header"><User/> <h4 className="font-bold">المعلومات الشخصية</h4></div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <DetailBlock label="اللقب" value={selected.lastNameAr} />
                        <DetailBlock label="الاسم" value={selected.firstNameAr} />
                        <DetailBlock label="الهاتف" value={selected.phone} />
                      </div>
                   </section>

                   <div className="sticky bottom-0 bg-white pt-6 border-t flex justify-center gap-4">
                      <button onClick={() => updateStatus(selected.id, 'مقبول')} className="bg-dz-green text-white px-8 py-3 rounded-xl font-bold">قبول</button>
                      <button onClick={() => updateStatus(selected.id, 'مرفوض')} className="bg-red-600 text-white px-8 py-3 rounded-xl font-bold">رفض</button>
                      <button onClick={() => setSelected(null)} className="bg-slate-200 px-8 py-3 rounded-xl">إغلاق</button>
                   </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
