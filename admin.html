<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø£Ø¯Ù…Ù† - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</title>
    <link rel="icon" href="https://i.top4top.io/p_3636li6n50.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Tajawal', sans-serif; background: #f8fafc; margin: 0; min-height: 100vh; padding: 10px; color: #334155; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #login-screen { display: flex; flex-direction: column; height: 90vh; justify-content: center; max-width: 400px; margin: 0 auto; }
        .logo-header { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #10b981; margin: 0 auto 20px; display: block; object-fit: cover; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border: 1px solid #e2e8f0; }
        
        input, select { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-family: 'Tajawal'; font-size: 14px; background: #fff; }
        button { width: 100%; padding: 10px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #dashboard { max-width: 1100px; margin: 0 auto; display: none; padding-bottom: 50px; }
        
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: #fff; padding: 10px 15px; border-radius: 8px; border-right: 4px solid #10b981; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        
        .add-section { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0; }
        .add-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; }

        /* --- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª (Ø§Ù„Ø³Ø·Ø± Ø§Ù„ÙˆØ§Ø­Ø¯) --- */
        .match-row {
            display: flex; flex-wrap: wrap; align-items: center;
            background: #fff; border: 1px solid #e2e8f0; border-radius: 8px;
            margin-bottom: 8px; padding: 5px 10px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            transition: 0.2s;
        }
        .match-row:hover { border-color: #10b981; transform: translateY(-1px); }

        .col-info { width: 100%; font-size: 0.75rem; color: #94a3b8; margin-bottom: 5px; border-bottom: 1px dashed #f1f5f9; padding-bottom: 2px; text-align: center; }
        
        .col-teams { flex: 4; display: flex; align-items: center; gap: 5px; min-width: 250px; }
        .team-display { display: flex; align-items: center; gap: 5px; width: 45%; }
        .team-display img { width: 28px; height: 28px; border-radius: 50%; object-fit: contain; border: 1px solid #eee; }
        .team-display.home { justify-content: flex-start; }
        .team-display.away { justify-content: flex-end; }
        
        .team-name-input { width: 100% !important; margin: 0 !important; padding: 5px !important; font-size: 0.8rem !important; border: none !important; background: transparent !important; font-weight: bold; }
        .team-name-input:focus { background: #f0fdf4 !important; }
        .team-name-input.right { text-align: right; }
        .team-name-input.left { text-align: left; }

        .col-score { flex: 2; display: flex; align-items: center; justify-content: center; gap: 5px; min-width: 90px; }
        .input-score { width: 35px !important; text-align: center; font-weight: 800; font-size: 1.1rem; padding: 2px !important; margin: 0 !important; border: 1px solid #cbd5e1 !important; height: 35px; background: #f8fafc; }

        /* Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„ÙˆÙ‚Øª */
        .col-controls { flex: 3; display: flex; align-items: center; gap: 8px; justify-content: center; min-width: 320px; }
        .status-select { width: auto !important; margin: 0 !important; padding: 5px !important; font-size: 0.8rem !important; flex: 1.5; height: 36px; cursor: pointer;}
        
        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø§Øª */
        .status-select.not-started { background: #f1f5f9; color: #64748b; }
        .status-select.live { background: #dcfce7; color: #166534; border-color: #22c55e; }
        .status-select.break { background: #ffedd5; color: #9a3412; border-color: #f97316; }
        .status-select.ended { background: #1e293b; color: #fff; border-color: #0f172a; }

        .timer-box { display: flex; align-items: center; gap: 2px; background: #f8fafc; padding: 2px; border-radius: 6px; border: 1px solid #e2e8f0; flex: 1; justify-content: center; }
        .time-input { width: 40px !important; text-align: center; margin: 0 !important; padding: 0 !important; font-weight: bold; border: none !important; background: transparent !important; font-size: 1rem; }

        .col-actions { flex: 0.5; display: flex; justify-content: flex-end; gap: 5px; min-width: 70px; }
        .btn-icon { width: 32px; height: 32px; padding: 0; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; color: white; border: none; cursor: pointer; }
        
        .btn-save { background: #3b82f6; }
        .btn-del { background: #ef4444; }
        .btn-play { background: #10b981; }
        .btn-pause { background: #f59e0b; }

        .input-mini { border: none; background: #f8fafc; text-align: center; border-radius: 4px; padding: 5px; width: 100%; font-size: 0.75rem; color: #64748b; }

        @media (max-width: 768px) {
            .match-row { padding: 10px; }
            .col-teams { width: 100%; order: 1; margin-bottom: 5px; }
            .col-score { width: 30%; order: 2; }
            .col-actions { width: 70%; order: 3; }
            .col-controls { width: 100%; order: 4; margin-top: 5px; border-top: 1px dashed #e2e8f0; padding-top: 5px; }
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="card" style="text-align:center;">
            <img src="https://i.top4top.io/p_3636li6n50.jpg" class="logo-header">
            <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù</h3>
            <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" style="direction: ltr;">
            <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="direction: ltr;">
            <button id="btnLogin">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="dashboard">
        <div class="dashboard-header">
            <h3 style="margin:0">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</h3>
            <button onclick="window.location.reload()" style="width:auto; background:#64748b; font-size:0.8rem;">ØªØ­Ø¯ÙŠØ«</button>
        </div>

        <div class="add-section">
            <h4 style="margin:0 0 10px 0; color:#10b981;">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø±Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø©</h4>
            <div class="add-grid">
                <select id="newLeague" onchange="updateClubsList()">
                    <option value="" disabled selected>-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© --</option>
                    <option value="Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø£)">Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø£)</option>
                    <option value="Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø¨)">Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø¨)</option>
                    <option value="Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ (ÙÙˆØ¬ Ø¬)">Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ (ÙÙˆØ¬ Ø¬)</option>
                    <option value="Ù‚Ø³Ù… Ù…Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø·Ø§Øª">Ù‚Ø³Ù… Ù…Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø·Ø§Øª</option>
                    <option value="Ø´Ø±ÙÙŠ Ø§Ù„Ø£ØºÙˆØ§Ø·">Ø´Ø±ÙÙŠ Ø§Ù„Ø£ØºÙˆØ§Ø·</option>
                    <option value="ÙˆÙ„Ø§Ø¦ÙŠ Ø§Ù„Ø£ØºÙˆØ§Ø·">ÙˆÙ„Ø§Ø¦ÙŠ Ø§Ù„Ø£ØºÙˆØ§Ø·</option>
                    <option value="ÙƒØ£Ø³ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©">ÙƒØ£Ø³ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© ğŸ†</option>
                </select>
                
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ù…Ù† 1 Ø¥Ù„Ù‰ 40 -->
                <select id="newRound">
                    <option value="" disabled selected>-- Ø§Ø®ØªØ± Ø§Ù„Ø¬ÙˆÙ„Ø© --</option>
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª -->
                </select>
            </div>
            <div class="add-grid" style="margin-top:10px;">
                <select id="newHome" class="club-select"><option value="">Ø§Ù„Ù…Ø³ØªØ¶ÙŠÙ</option></select>
                <select id="newAway" class="club-select"><option value="">Ø§Ù„Ø¶ÙŠÙ</option></select>
                <button id="btnAdd" style="height: 42px;">Ù†Ø´Ø±</button>
            </div>
        </div>

        <div id="matches-list"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAXLSZ5OqPEOnP0DUx3w75fU2xxiVkrWcE",
          authDomain: "koooralaghouat.firebaseapp.com",
          projectId: "koooralaghouat",
          storageBucket: "koooralaghouat.firebasestorage.app",
          messagingSenderId: "84750708348",
          appId: "1:84750708348:web:179ec7acf8fc2f357e23f9",
          measurementId: "G-4YSP7SWPGV"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬ÙˆÙ„Ø§Øª (1-40)
        const roundSelect = document.getElementById('newRound');
        for(let i=1; i<=40; i++) {
            let opt = document.createElement('option');
            opt.value = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${i}`;
            opt.innerText = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${i}`;
            roundSelect.appendChild(opt);
        }

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù†Ø¯ÙŠØ©
        window.leaguesData = {
            "Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø£)": [
                { name: "Ø´ Ø¨ Ø¹ÙŠÙ† Ø§Ù…ÙŠÙ†Ø§Ø³", logo: "https://lrfouargla.com/uploads/images/logos/1(1).png" },
                { name: "Ù†.Ø±.ØªÙ‚Ù†ØªÙˆØ±ÙŠÙ†", logo: "https://lrfouargla.com/uploads/images/logos/203-1601155957.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ Ø§Ù„ØºØ±Ø§Ø¨Ø©", logo: "https://lrfouargla.com/uploads/images/logos/sssx.png" },
                { name: "Ù… .Ø´Ø¨Ø§Ø¨ .Ø§Ù„Ù…Ø®Ø§Ø¯Ù…Ø©", logo: "https://lrfouargla.com/uploads/images/logos/sz.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø¨Ø±ÙŠØ§Ù†", logo: "https://lrfouargla.com/uploads/images/logos/47.png" },
                { name: "ØªØ±Ø¬ÙŠ ØªÙ‚Ø¯ÙŠØ¯ÙŠÙ†", logo: "https://lrfouargla.com/uploads/images/logos/133.png" },
                { name: "Ùˆ.Ø±.Ø¨.Ø§Ù„Ø¯Ø¨ÙŠÙ„Ø©", logo: "https://lrfouargla.com/uploads/images/logos/qqqqqq.png" },
                { name: "Ù†Ø§Ø¯ÙŠ Ø¨ÙˆØºÙØ§Ù„Ø©", logo: "https://lrfouargla.com/uploads/images/logos/23.png" },
                { name: "Ø§Ù„Ù…Ù†Ø¸Ø± Ø§Ù„Ø¬Ù…ÙŠÙ„", logo: "https://lrfouargla.com/uploads/images/logos/CSBV%20(1).png" },
                { name: "Ù….Ùƒ.Ø£Ù…Ù„ Ø§Ù„Ù†Ø²Ù„Ø©", logo: "https://lrfouargla.com/uploads/images/logos/sss%20%E2%80%AB%E2%80%AC.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø§Ù„Ø±Ø¨Ø§Ø­", logo: "https://lrfouargla.com/uploads/images/logos/73.png" },
                { name: "Ø´Ø¨Ø§Ø¨ Ø³ÙŠØ¯ÙŠ Ø¨ÙˆØ¹Ø²ÙŠØ²", logo: "https://lrfouargla.com/uploads/images/logos/13.png" },
                { name: "Ø´Ø¨Ø§Ø¨ Ù‚ØµØ± Ø§Ù„Ø­ÙŠØ±Ø§Ù†", logo: "https://lrfouargla.com/uploads/images/logos/54.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø­Ø§Ø³ÙŠ Ø§Ù„Ø¯Ù„Ø§Ø¹Ø©", logo: "https://lrfouargla.com/uploads/images/logos/53.png" }
            ],
            "Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø¨)": [
                { name: "Ø´Ø¨Ø§Ø¨ Ù‚ØµØ± ÙˆØ±Ù‚Ù„Ø©", logo: "https://lrfouargla.com/uploads/images/logos/15826488_199664807171500_3091424271281007906_n.gif" },
                { name: "ÙˆÙØ§Ù‚ Ø§Ù„Ù…ØºÙŠØ±", logo: "https://lrfouargla.com/uploads/images/logos/111.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ .Ø±. Ø¨.Ø§Ù„Ø£ØºÙˆØ§Ø·", logo: "https://lrfouargla.com/uploads/images/logos/IMG-20241109-WA0007.jpg" },
                { name: "ÙˆÙØ§Ù‚ Ø¹ÙŠÙ† Ù…Ø§Ø¶ÙŠ", logo: "https://lrfouargla.com/uploads/images/logos/125.png" },
                { name: "Ø£Ù…Ù„ Ø³ÙˆÙ", logo: "https://lrfouargla.com/uploads/images/logos/88.png" },
                { name: "Ø´Ø¨Ø§Ø¨ Ù†Ù‡Ù‚Ø§Ø±", logo: "https://lrfouargla.com/uploads/images/logos/102.png" },
                { name: "Ù‡Ù„Ø§Ù„ ØºØ±Ø¯Ø§ÙŠØ©", logo: "https://lrfouargla.com/uploads/images/logos/75.png" },
                { name: "Ø§Ù„ØªØ¶Ø§Ù…Ù† Ø§Ù„Ø³ÙˆÙÙŠ", logo: "https://lrfouargla.com/uploads/images/logos/72.png" },
                { name: "Ø¥. Ø§Ù„Ø±Ø¨Ø§Ø¶ÙŠ Ø§Ù„Ù…Ù†ÙŠØ¹ÙŠ", logo: "https://lrfouargla.com/uploads/images/logos/WhatsApp%20Image%202025-10-25%20%C3%A0%2022.02.03_23b4051f.jpg" },
                { name: "Ø´.Ø£.ØªÙ…Ù†Ø±Ø§Ø³Øª", logo: "https://lrfouargla.com/uploads/images/logos/100.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø¹ÙŠÙ† Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡", logo: "https://lrfouargla.com/uploads/images/logos/40.png" },
                { name: "ÙˆÙØ§Ù‚ Ù…Ù‚Ø±", logo: "https://lrfouargla.com/uploads/images/logos/38.png" },
                { name: "Ø¥.Ø§Ù„Ø­Ù…Ø§Ø¯ÙŠÙ†", logo: "https://lrfouargla.com/uploads/images/logos/168-1531611858.png" },
                { name: "Ù†Ø¬Ù… Ø¨ÙˆØºÙØ§Ù„Ø©", logo: "https://lrfouargla.com/uploads/images/logos/NRNBO-02.png" }
            ],
            "Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ (ÙÙˆØ¬ Ø¬)": [
                { name: "Ù… .Ø´ .Ø§Ù„Ø«Ù†ÙŠØ© ØºØ±Ø¯Ø§ÙŠØ©", logo: "https://lrfouargla.com/uploads/images/logos/449-1634476753.png" },
                { name: "Ù…ÙˆÙ„ÙˆØ¯ÙŠØ© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡", logo: "https://lrfouargla.com/uploads/images/logos/46.png" },
                { name: "Ø±Ø§Ø¦Ø¯ Ø§Ù„Ù…Ù†ÙŠØ¹Ø©", logo: "https://lrfouargla.com/uploads/images/logos/7.png" },
                { name: "Ø¨Ù† Ù†Ø§ØµØ± Ø¨Ù† Ø´Ù‡Ø±Ø©", logo: "https://lrfouargla.com/uploads/images/logos/49(1).png" },
                { name: "Ø¥.Ø¶Ø§ÙŠØ© Ø¨Ù† Ø¶Ø­ÙˆØ©", logo: "https://lrfouargla.com/uploads/images/logos/57(1).png" },
                { name: "Ù…Ø³ØªÙ‚Ø¨Ù„ Ù„Ù…Ø§Ø¶ÙŠ", logo: "https://lrfouargla.com/uploads/images/logos/56.png" },
                { name: "Ø±Ø§Ø¦Ø¯ Ø­Ø§Ø³ÙŠ Ø§Ù„Ù‚Ø§Ø±Ø©", logo: "https://lrfouargla.com/uploads/images/logos/134.png" },
                { name: "Ø¹ÙŠÙ† Ø³ÙŠØ¯ÙŠ Ø¹Ù„ÙŠ", logo: "https://lrfouargla.com/uploads/images/logos/1528-1663416912.png" },
                { name: "Ù†Ø§Ø¯ÙŠ Ø§Ù„Ø£ØºÙˆØ§Ø·", logo: "https://lrfouargla.com/uploads/images/logos/50.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ ØªØ§Ø¬Ù…ÙˆØª", logo: "https://lrfouargla.com/uploads/images/logos/nirbt.png" },
                { name: "Ø§ØªØ­Ø§Ø¯.Ø¨Ø±ÙŠØ¯Ø©", logo: "https://lrfouargla.com/uploads/images/logos/2174-1665949908.png" },
                { name: "ØªØ±Ø¬ÙŠ Ù…Ø±Ù…Ø§Ø¯", logo: "https://lrfouargla.com/uploads/images/logos/51.png" },
                { name: "ÙˆØ¯Ø§Ø¯ Ø²Ù„ÙØ§Ù†Ø©", logo: "https://lrfouargla.com/uploads/images/logos/t%C3%A9l%C3%A9chargement%20(1).jpg" },
                { name: "Ø§Ù„Ø§Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø±Ø©", logo: "https://lrfouargla.com/uploads/images/logos/IMG-20231119-WA0010.jpg" },
                { name: "Ø£Ù…Ù„ Ø³ÙŠØ¯ÙŠ Ø¨ÙˆØ²ÙŠØ¯", logo: "https://lrfouargla.com/uploads/images/logos/49.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ Ø´Ø¨Ø§Ø¨ ØªØ§ØºÙŠØª", logo: "https://lrfouargla.com/uploads/images/logos/1855-1664293222.png" }
            ],
            "Ù‚Ø³Ù… Ù…Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø·Ø§Øª": [
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø§Ù„Ù†Ø²Ù„Ø©", logo: "https://lirf.org.dz/uploads/images/logos/3.png" },
                { name: "Ù†Ø§Ø¯ÙŠ ØªÙ‚Ø±Øª", logo: "https://lirf.org.dz/uploads/images/logos/received_257439396802495.jpeg" },
                { name: "Ø£ Ù…ØªÙ„ÙŠÙ„ÙŠ Ø§Ù„Ø´Ø¹Ø§Ù†Ø¨Ø©", logo: "https://lirf.org.dz/uploads/images/logos/5.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø®Ù†Ù‚", logo: "https://lirf.org.dz/uploads/images/logos/IRBKheneg.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø§Ù„Ø²Ø§ÙˆÙŠØ©", logo: "https://lirf.org.dz/uploads/images/logos/6.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ Ø¢ÙÙ„Ùˆ", logo: "https://lirf.org.dz/uploads/images/logos/407-1656244680.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ù‡Ù…Ø§ÙŠØ³Ø©", logo: "https://lirf.org.dz/uploads/images/logos/102.png" },
                { name: "Ù…Ø´Ø¹Ù„ Ø­Ø§Ø³ÙŠ Ù…Ø³Ø¹ÙˆØ¯", logo: "https://lirf.org.dz/uploads/images/logos/13.png" },
                { name: "Ø´Ø¨Ø§Ø¨ Ø¬Ø§Ù…Ø¹Ø©", logo: "https://lirf.org.dz/uploads/images/logos/39(1).png" },
                { name: "Ø±Ø§Ø¦Ø¯ Ù‚Ù„ØªØ©Ø³ Ø³Ø¹Ø¯", logo: "https://lirf.org.dz/uploads/images/logos/Gueltet%20Sidi%20Saad.png" },
                { name: "Ø§ÙˆÙ„Ù…Ø¨ÙŠ Ø§Ù„ÙˆØ§Ø¯", logo: "https://lirf.org.dz/uploads/images/logos/Olympique%20El-Oued.png" },
                { name: "Ø£ÙˆÙ„Ù…Ø¨ÙŠÙƒ Ø§Ù„Ù…Ù‚Ø±Ù†", logo: "https://lirf.org.dz/uploads/images/logos/8.png" },
                { name: "Ù†Ø¬ÙˆÙ… Ø§Ù„ÙŠØ²ÙŠ", logo: "https://lirf.org.dz/uploads/images/logos/16.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø­Ø§Ø³ÙŠ Ø§Ù„Ø±Ù…Ù„", logo: "https://lirf.org.dz/uploads/images/logos/12.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ Ø³ÙˆÙ", logo: "https://lirf.org.dz/uploads/images/logos/412-1715352850.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ ÙˆØ±Ù‚Ù„Ø©", logo: "https://lirf.org.dz/uploads/images/logos/414-1662939264.png" }
            ],
            "default": [ { name: "ÙØ±ÙŠÙ‚ 1", logo: "" }, { name: "ÙØ±ÙŠÙ‚ 2", logo: "" } ]
        };

        window.updateClubsList = () => {
            const league = document.getElementById('newLeague').value;
            const homeSelect = document.getElementById('newHome');
            const awaySelect = document.getElementById('newAway');
            homeSelect.innerHTML = '<option value="">Ø§Ù„Ù…Ø³ØªØ¶ÙŠÙ</option>';
            awaySelect.innerHTML = '<option value="">Ø§Ù„Ø¶ÙŠÙ</option>';
            const clubs = window.leaguesData[league] || window.leaguesData["default"];
            clubs.forEach(club => {
                const opt1 = document.createElement('option'); opt1.value = club.name; opt1.innerText = club.name; opt1.setAttribute('data-logo', club.logo); homeSelect.appendChild(opt1);
                const opt2 = document.createElement('option'); opt2.value = club.name; opt2.innerText = club.name; opt2.setAttribute('data-logo', club.logo); awaySelect.appendChild(opt2);
            });
        };

        const getLogoFromSelect = (selectId) => {
            const select = document.getElementById(selectId);
            return select.options[select.selectedIndex].getAttribute('data-logo') || 'https://cdn-icons-png.flaticon.com/512/53/53283.png';
        };

        onAuthStateChanged(auth, (user) => {
            document.getElementById('login-screen').style.display = user ? 'none' : 'flex';
            document.getElementById('dashboard').style.display = user ? 'block' : 'none';
            if(user) loadMatches();
        });

        document.getElementById('btnLogin').addEventListener('click', () => {
            signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('password').value)
            .catch(e => alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„"));
        });

        document.getElementById('btnAdd').addEventListener('click', async () => {
            const league = document.getElementById('newLeague').value;
            const round = document.getElementById('newRound').value;
            const home = document.getElementById('newHome').value;
            const away = document.getElementById('newAway').value;
            if(league && home && away) {
                if(confirm("Ù†Ø´Ø± Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©ØŸ")) {
                    await addDoc(collection(db, "matches"), {
                        league, round, home, away, homeLogo: getLogoFromSelect('newHome'), awayLogo: getLogoFromSelect('newAway'),
                        scoreH: 0, scoreA: 0, scorersH: "", scorersA: "", 
                        status: "Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ù„Ù… ØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯", 
                        elapsedSeconds: 0, 
                        isRunning: false, lastStartTime: null
                    });
                    alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± âœ…");
                }
            } else { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); }
        });

        function loadMatches() {
            onSnapshot(collection(db, "matches"), (snapshot) => {
                const list = document.getElementById('matches-list');
                list.innerHTML = '';
                snapshot.forEach((d) => {
                    const m = d.data();
                    const id = d.id;
                    const sel = (val) => m.status === val ? 'selected' : '';

                    let currentSeconds = m.elapsedSeconds || 0;
                    if(m.isRunning && m.lastStartTime) {
                        const now = Date.now();
                        currentSeconds += Math.floor((now - m.lastStartTime) / 1000);
                    }
                    const minutes = Math.floor(currentSeconds / 60);

                    const formatTime = (secs) => {
                        const mins = Math.floor(secs / 60).toString().padStart(2, '0');
                        const seconds = Math.floor(secs % 60).toString().padStart(2, '0');
                        return `${mins}:${seconds}`;
                    };

                    // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
                    let statusClass = "not-started";
                    if(m.status.includes("Ø¬Ø§Ø±ÙŠ")) statusClass = "live";
                    if(m.status.includes("Ø§Ø³ØªØ±Ø§Ø­Ø©")) statusClass = "break";
                    if(m.status.includes("Ø§Ù†ØªÙ‡Øª")) statusClass = "ended";

                    list.innerHTML += `
                    <div class="match-row">
                        <div class="col-info">${m.league} (${m.round})</div>

                        <div class="col-teams">
                            <div class="team-display home">
                                <img src="${m.homeLogo}">
                                <input type="text" id="hName-${id}" value="${m.home}" class="team-name-input right">
                            </div>
                            <div class="col-score">
                                <input type="number" id="sH-${id}" value="${m.scoreH}" class="input-score">
                                <span style="font-weight:bold;">-</span>
                                <input type="number" id="sA-${id}" value="${m.scoreA}" class="input-score">
                            </div>
                            <div class="team-display away">
                                <input type="text" id="aName-${id}" value="${m.away}" class="team-name-input left">
                                <img src="${m.awayLogo}">
                            </div>
                        </div>

                        <div class="col-controls">
                            <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø¨Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© -->
                            <select id="st-${id}" class="status-select ${statusClass}">
                                <option value="Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ù„Ù… ØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯" ${sel("Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ù„Ù… ØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯")}>âšª Ù„Ù… ØªØ¨Ø¯Ø£</option>
                                <option value="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„" ${sel("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„")}>ğŸŸ¢ Ø§Ù„Ø´ÙˆØ· 1</option>
                                <option value="Ø§Ø³ØªØ±Ø§Ø­Ø© (Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„)" ${sel("Ø§Ø³ØªØ±Ø§Ø­Ø© (Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„)")}>ğŸŸ  Ø§Ø³ØªØ±Ø§Ø­Ø©</option>
                                <option value="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø«Ø§Ù†ÙŠ" ${sel("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø«Ø§Ù†ÙŠ")}>ğŸŸ¢ Ø§Ù„Ø´ÙˆØ· 2</option>
                                <option value="Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©" ${sel("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©")}>âš« Ø§Ù†ØªÙ‡Øª</option>
                            </select>

                            <div class="timer-box">
                                <button class="btn-icon btn-play" onclick="window.toggleTimer('${id}', true, ${currentSeconds})" ${m.isRunning ? 'disabled style="opacity:0.5"' : ''} title="ØªØ´ØºÙŠÙ„"><i class="fa-solid fa-play"></i></button>
                                <input type="number" id="tm-set-${id}" value="${minutes}" class="time-input" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©">
                                <button class="btn-icon btn-pause" onclick="window.toggleTimer('${id}', false, ${currentSeconds})" ${!m.isRunning ? 'disabled style="opacity:0.5"' : ''} title="Ø¥ÙŠÙ‚Ø§Ù"><i class="fa-solid fa-pause"></i></button>
                            </div>
                            
                            <span class="admin-live-timer" data-running="${m.isRunning}" data-start="${m.lastStartTime}" data-base="${m.elapsedSeconds}" style="font-size:0.8rem; font-weight:bold; color:#10b981; min-width:40px;">
                                ${formatTime(currentSeconds)}
                            </span>
                        </div>

                        <div class="col-actions">
                            <button class="btn-icon btn-save" onclick="window.upd('${id}', ${m.isRunning}, ${currentSeconds})" title="Ø­ÙØ¸"><i class="fa-solid fa-check"></i></button>
                            <button class="btn-icon btn-del" onclick="window.del('${id}')" title="Ø­Ø°Ù"><i class="fa-solid fa-trash"></i></button>
                        </div>
                        
                        <div style="width:100%; display:flex; gap:10px; margin-top:5px;">
                             <input type="text" id="scH-${id}" value="${m.scorersH || ''}" placeholder="Ù‡Ø¯Ø§ÙÙŠ Ø§Ù„Ù…Ø³ØªØ¶ÙŠÙ" class="input-mini">
                             <input type="text" id="scA-${id}" value="${m.scorersA || ''}" placeholder="Ù‡Ø¯Ø§ÙÙŠ Ø§Ù„Ø¶ÙŠÙ" class="input-mini">
                        </div>
                        <input type="hidden" id="hLogo-${id}" value="${m.homeLogo}">
                        <input type="hidden" id="aLogo-${id}" value="${m.awayLogo}">
                    </div>`;
                });
            });
        }

        window.toggleTimer = async (id, start, currentTotalSeconds) => {
            const manualMinutes = Number(document.getElementById(`tm-set-${id}`).value);
            let baseSeconds = currentTotalSeconds;
            const displayedMinutes = Math.floor(currentTotalSeconds / 60);
            if (manualMinutes !== displayedMinutes) baseSeconds = manualMinutes * 60;

            await updateDoc(doc(db, "matches", id), {
                isRunning: start,
                lastStartTime: start ? Date.now() : null,
                elapsedSeconds: baseSeconds 
            });
        };

        window.upd = async (id, isRunning, currentSeconds) => {
            const status = document.getElementById(`st-${id}`).value;
            let newIsRunning = isRunning;
            
            // âš ï¸ Ø¥ÙŠÙ‚Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø£Ùˆ Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©
            if (status.includes("Ø§Ù†ØªÙ‡Øª") || status.includes("Ø§Ø³ØªØ±Ø§Ø­Ø©")) {
                newIsRunning = false;
            }

            let updateData = {
                home: document.getElementById(`hName-${id}`).value,
                away: document.getElementById(`aName-${id}`).value,
                homeLogo: document.getElementById(`hLogo-${id}`).value,
                awayLogo: document.getElementById(`aLogo-${id}`).value,
                scoreH: Number(document.getElementById(`sH-${id}`).value),
                scoreA: Number(document.getElementById(`sA-${id}`).value),
                scorersH: document.getElementById(`scH-${id}`).value,
                scorersA: document.getElementById(`scA-${id}`).value,
                status: status,
                isRunning: newIsRunning
            };
            
            if (!newIsRunning) {
                const manualMinutes = Number(document.getElementById(`tm-set-${id}`).value);
                const displayedMinutes = Math.floor(currentSeconds / 60);
                
                if (manualMinutes !== displayedMinutes) {
                    updateData.elapsedSeconds = manualMinutes * 60;
                } else {
                    updateData.elapsedSeconds = currentSeconds; 
                }
                updateData.lastStartTime = null;
            }

            await updateDoc(doc(db, "matches", id), updateData);
            
            // ÙˆÙ…ÙŠØ¶ Ø²Ø± Ø§Ù„Ø­ÙØ¸
            const btn = document.querySelector(`button[onclick*="'${id}'"].btn-save`);
            if(btn) { btn.innerHTML = '<i class="fa-solid fa-check-double"></i>'; setTimeout(() => btn.innerHTML = '<i class="fa-solid fa-check"></i>', 1000); }
        };
        
        window.del = async (id) => { if(confirm("Ø­Ø°ÙØŸ")) await deleteDoc(doc(db, "matches", id)); };

        setInterval(() => {
            const timers = document.querySelectorAll('.admin-live-timer');
            const now = Date.now();
            timers.forEach(timer => {
                const isRunning = timer.getAttribute('data-running') === 'true';
                if (isRunning) {
                    const startTime = parseInt(timer.getAttribute('data-start'));
                    const baseSeconds = parseInt(timer.getAttribute('data-base'));
                    const totalSeconds = baseSeconds + (now - startTime) / 1000;
                    const m = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
                    const s = Math.floor(totalSeconds % 60).toString().padStart(2, '0');
                    timer.innerText = `${m}:${s}`;
                }
            });
        }, 1000);
    </script>
</body>
</html>